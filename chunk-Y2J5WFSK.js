import{a as u}from"./chunk-5JDCOLZI.js";import{a as O}from"./chunk-QKVZ2CT4.js";import{b as R}from"./chunk-GSZV43AH.js";import{y as n,z as E}from"./chunk-2SKVBX5T.js";import{Cb as N,Gb as a,H as e,Hb as l,L as f,O as s,a as S,b as $,f as b,h as c,l as g,v as p,vb as v,z as h}from"./chunk-5IAL5MBJ.js";var P=({name:o,email:t,uid:x,createdAt:i})=>({name:o.S,email:t.S,uid:x.S,createdAt:i.S});var j=(()=>{let t=class t{constructor(i){this.http=i}getProfile(){return this.http.get(`${a.BASE_URL}${a.PROFILE}`)}updateProfileName(i){return this.http.put(`${a.BASE_URL}${a.PROFILE}`,{name:i})}};t.\u0275fac=function(r){return new(r||t)(s(v))},t.\u0275prov=f({token:t,factory:t.\u0275fac,providedIn:"root"});let o=t;return o})();var G=(()=>{let t=class t{constructor(i,r,m,d,I){this.http=i,this.store=r,this.notificationService=m,this.authService=d,this.router=I,this.profile=null,this.subscription=[],this.loading$$=new b(!1),this.loading$=this.loading$$.asObservable(),this.profile$=this.store.select(O)}getProfile(){return this.profile?this.profile:(this.loading$$.next(!0),this.http.getProfile().pipe(g(P),e(i=>this.store.dispatch(u({profile:i}))),e(i=>{this.profile=i}),h(()=>this.loading$$.next(!1)),p(i=>(this.notificationService.error(i.error.message||n.UNKNOWN_ERROR),c))).subscribe(),null)}updateProfileName(i){this.loading$$.next(!0);let r=$(S({},this.profile),{name:i}),m=this.http.updateProfileName(i).pipe(e(()=>this.store.dispatch(u({profile:r}))),e(()=>{this.profile=r}),e(()=>this.notificationService.success(n.SUCCESS_PROFILE_NAME)),p(d=>(this.notificationService.error(d.error.message||n.UNKNOWN_ERROR),c)),h(()=>this.loading$$.next(!1))).subscribe();this.subscription.push(m)}logout(){this.loading$$.next(!0);let i=this.authService.signOut().pipe(p(r=>(this.notificationService.error(r.error.message||n.UNKNOWN_ERROR),c)),e(()=>this.notificationService.success(n.SUCCESS_LOGOUT)),e(()=>this.store.dispatch(u({profile:{uid:""}}))),e(()=>{this.profile=null}),e(()=>this.router.navigate(["/signin"])),e(()=>l.removeCredentials()),h(()=>this.loading$$.next(!1))).subscribe();this.subscription.push(i)}ngOnDestroy(){this.subscription.forEach(i=>i.unsubscribe())}};t.\u0275fac=function(r){return new(r||t)(s(j),s(R),s(E),s(l),s(N))},t.\u0275prov=f({token:t,factory:t.\u0275fac,providedIn:"root"});let o=t;return o})();export{G as a};
